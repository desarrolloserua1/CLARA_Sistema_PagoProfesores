
$(function () {

    $(window).load(function () {


        $("#formbtnadd").html('Guardar');
        $("#formbtnsave").hide();
        $("#formbtndelete").hide();


        formValidation.Inputs(["role", "descripcion"]);
        formValidation.notEmpty('role', 'El campo role Actual no debe de estar vacio');
        formValidation.notEmpty('descripcion', 'El campo descripción no debe estar vacio');
      
    });
});//End function jquery

//valida: solo numeros
$("#clave").live("keypress", function (e) {
    var tecla = document.all ? tecla = e.keyCode : tecla = e.which;
    if (tecla == 13)
    {   var search = $("#clave").val();        
        formPage.edit(search);        
    }
    else 
        return ((tecla > 47 && tecla < 58) || tecla == 8 || tecla == 13 || tecla == 110 || tecla == 189 || tecla == 190 || tecla == 0);
});

function enviarRolPermisos(id) {
    setTimeout("window.location.href = '/Permisos?idrole=" + id + "'", 0);
}



var formPage = function () {
    var idRole;
    
    "use strict"; return {

        clean: function () {
           // $("#clave").prop("disabled", false);
            // $("#clave").val("");
            formValidation.Clean();
            var role = $("#role").val("");
            var description = $("#descripcion").val("");
            

            $("#formbtnadd").show();
            $("#formbtnadd").prop("disabled", false);
            $("#formbtnsave").hide();
            $("#formbtnsave").prop("disabled", true);
            $("#formbtndelete").prop("disabled", true);
            $("#formbtndelete").hide();

              $("#role").removeClass("form-control parsley-error").addClass("form-control");            
             $("#descripcion").removeClass("form-control parsley-error").addClass("form-control"); 
           
        },


            
        edit: function (id) {

            idRole = id;

            $("#role").removeClass("form-control parsley-error").addClass("form-control");
            $("#descripcion").removeClass("form-control parsley-error").addClass("form-control");

            var model = {
                idRole: id
            }

            $.ajax({
                type: "POST",
                dataType: 'json',
                cache: false,
                url: "/Roles/Edit/",
                data: model,
                success: function (data) {
                    data = jQuery.parseJSON(data);
                    $('html, body').animate({ scrollTop: 0 }, 'fast');
                    if (data.Role != "") { $("#clave").prop("disabled", true); }                    
                    $("#clave").val(data.idRole);
                    $("#role").val(data.Role);
                    $("#descripcion").val(data.Description);
                    
                    $("#formbtnadd").hide();
                    $("#formbtnsave").show();
                    $("#formbtndelete").show();
                    $("#formbtnadd").prop("disabled", true);
                    $("#formbtnsave").prop("disabled", false);
                    $("#formbtndelete").prop("disabled", false);
                }

            });


        },

        save:function(){//edita los campos

            if (!formValidation.Validate())
                return;

                    var model = {
                        idRole: idRole,
                        Role: $("#role").val(),
                        Description: $("#descripcion").val(),
                    }

                    $.ajax({
                        type: "POST",
                        dataType: 'json',
                        cache: false,
                        url: "/Roles/Save/",
                        data: model,
                        success: function (data) {
                            $('#content').prepend(data.msg);
                            
                            DataTable.init();
                        }

                    });

               
        },

        delete: function () {
           
            var confirmar = confirm("Estas seguro de borrar el Rol?");
            if (confirmar == true) {

                var model = {
                    idRole: idRole
                }

                $.ajax({
                    type: "POST",
                    dataType: 'json',
                    cache: false,
                    url: "/Roles/Delete/",
                    data: model,
                    success: function (data) {
                        $('#content').prepend(data.msg);
                        formPage.clean();
                        DataTable.init();
                    }

                });
             }

           

        },

            add: function () {

                if (!formValidation.Validate())
                    return;

                        var model = {
                            Role: $("#role").val(),
                            Description: $("#descripcion").val(),
                        }

                        $.ajax({
                            type: "POST",
                            dataType: 'json',
                            cache: false,
                            url: "/Roles/Add/",
                            data: model,
                            success: function (data) {

                                $('#content').prepend(data.msg);
                                formPage.clean();
                                DataTable.init();

                            }

                        });
                  

            },

            validateInputs: function () {

                var validado = true;

                if ($("#role").val() == "") { $("#role").removeClass("form-control").addClass("form-control parsley-error"); validado = false; }
                else { $("#role").removeClass("form-control parsley-error").addClass("form-control");  }
                if ($("#descripcion").val() == "") { $("#descripcion").removeClass("form-control").addClass("form-control parsley-error"); validado = false; }
                else { $("#descripcion").removeClass("form-control parsley-error").addClass("form-control");  }

                return validado;
            }


           





    }

}();


var DataTable = function () {
    var pag = 1;
    var order = "ROLE";
    var sortoption = {
        ASC:"ASC",
        DESC:"DESC"
    };
    var sort = sortoption.ASC;

    "use strict"; return {
        myName: 'DataTable',

        onkeyup_colfield_check:function(e){
            var enterKey = 13;
            if (e.which == enterKey) {
                pag = 1;
                this.init();
            }
        },

        exportExcel: function (table) {

            window.location.href = '/Roles/ExportExcel';

        },


        edit: function (id) {
            formPage.edit(id);
        },

        setPage: function (page) {
            pag = page;
            this.init();
        },

        setShow: function (page) {
            pag = 1;
            this.init();
        },

        Orderby: function (campo) {
            order = campo;
            var sortcampo = $('#' + this.myName + '-SORT-' + campo).data("sort");
            if (sortcampo == sortoption.ASC) { sort = sortoption.DESC;} else { sort = sortoption.ASC; }
            this.init();
        },

        init: function () {
           
            var show = $('#' + this.myName + '-data-elements-length').val();
            var search = $('#' + this.myName + '-searchtable').val();
            var orderby = order;
            var sorter = sort;

         

            /*$('div.block').block({
                css: { backgroundColor: 'transparent', color: '#336B86', border: "null" },
                overlayCSS: { backgroundColor: '#FFF' },
                message: '<img src="/Content/images/load-search.gif" /><br><h2> Buscando..</h2>'
            });*/

           
            
            $.ajax({
                type: "GET",
                cache: false,
                url: "/Roles/CreateDataTable/",
                data: "pg=" + pag + "&show=" + show + "&search=" + search + "&orderby=" + orderby + "&sort="+sorter+"&sesion=null",
                success: function (msg) {

                    //$('div.block').unblock();
                    $("#datatable").html(msg);
                    
                }

            });
        }
       
    }

  
}();


